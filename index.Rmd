---
title: "–†–∞–±–æ—Ç–∞ —Å–æ —Å–ø–∏—Å–∫–∞–º–∏: `purrr`"
author: "–ì. –ú–æ—Ä–æ–∑"
date: "12/21/2019"
output: 
  html_document:
    theme: spacelab
    highlight: pygments
    toc: yes
    toc_position: right
    toc_depth: 3
    toc_float: yes
    smooth_scroll: no
    code_folding: show
    df_print: paged
    include:
      after_body: footer.html
editor_options: 
  chunk_output_type: console
---

```{r, echo=FALSE}
library(qrcode)
qrcode_gen('https://agricolamz.github.io/2019.12.21_EU_purrr/index.html')
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(fig.width=12, fig.height=9)
```

```{r, message=FALSE}
library(tidyverse)
```

## –ß—Ç–æ —Ç–∞–∫–æ–µ —Å–ø–∏—Å–∫–∏?
–î–æ–ø—É—Å—Ç–∏–º, –≤—ã –∑–∞–±—ã–ª–∏, —á—Ç–æ —Ç–∞–∫–æ–µ —Å–ø–∏—Å–æ–∫:

```{r}
x <- list(m = "a", n = c(2, 4), o = c("blue", "green", "red"))
x
x$m
x[1]
x[[2]]
x[[2]][2]
```

![](images/6.01_lists.png)

–°–ø–∏—Å–∫–∏ –≤–Ω–µ R –æ–±—ã—á–Ω–æ —Ö—Ä–∞–Ω—è—Ç –≤ —Ñ–∞–π–ª–∞—Ö —Ç–∏–ø–∞ `.json` (–ø–æ-–∞–Ω–≥–ª–∏–π—Å–∫–∏ –≥–æ–≤–æ—Ä—è—Ç —Å —É–¥–∞—Ä–µ–Ω–∏–µ–º –Ω–∞ –ø–µ—Ä–≤—ã–π —Å–ª–æ–≥, –∞ –≤–æ—Ç –ø–æ-—Ä—É—Å—Å–∫–∏ –ø—Ä–∏–∂–∏–ª—Å—è –≤–∞—Ä–∏–∞–Ω—Ç —Å —É–¥–∞—Ä–µ–Ω–∏–µ–º –Ω–∞ –≤—Ç–æ—Ä–æ–π —Å–ª–æ–≥: –¥–∂–µ–π—Å–æÃÅ–Ω) –∏–ª–∏ `.xml` (–º—ã –æ–±—Å—É–¥–∏–º —Ç–æ–ª—å–∫–æ `.json`).

### –ü—Ä–µ–≤—Ä–∞—â–µ–Ω–∏–µ JSON –≤ —Å–ø–∏—Å–æ–∫ –∏ –æ–±—Ä–∞—Ç–Ω–æ
–°–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ, —á—Ç–æ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å, –ø—Ä–æ `.json`, —ç—Ç–æ —Ç–æ, —á—Ç–æ —Ç–∞–º –º–æ–≥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—Å—è:

* –ø–∞—Ä—ã –∫–ª—é—á –∏ –∑–Ω–∞—á–µ–Ω–∏–µ, –∑–∞–∫–ª—é—á–µ–Ω–Ω—ã–µ –≤ —Ñ–∏–≥—É—Ä–Ω—ã–µ —Å–∫–æ–±–∫–∏ `{"–∫–ª—é—á":"–∑–Ω–∞—á–µ–Ω–∏–µ"}`
* —É–ø–æ—Ä—è–¥–æ—á–Ω—ã–µ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –∑–Ω–∞—á–µ–Ω–∏–π, –∑–∞–∫–ª—é—á–µ–Ω–Ω—ã–µ –≤ –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ —Å–∫–æ–±–∫–∏ `["–∑–Ω–∞—á–µ–Ω–∏–µ_1","–∑–Ω–∞—á–µ–Ω–∏–µ_2",...]`
* –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –¥—Ä—É–≥–∏–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö

–ß—Ç–µ–Ω–∏–µ –∏ –∑–∞–ø–∏—Å—å `.json` —Ñ–∞–π–ª–æ–≤ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –ø–æ–º–æ—â–∏ –ø–∞–∫–µ—Ç–∞ `jsonlite` (–Ω–µ –≤—Ö–æ–¥–∏—Ç –≤ `tidyverse`). –î–ª—è –ø—Ä–∏–º–µ—Ä–∞ —Å–∫–∞—á–∞–µ–º –¥–∞—Ç–∞—Å–µ—Ç 30 –≥–µ—Ä–æ–µ–≤ –ò–≥—Ä—ã –ø—Ä–µ—Å—Ç–æ–ª–æ–≤, –∫–æ—Ç–æ—Ä—ã–π  –î–∂. –†. –†. –ú–∞—Ä—Ç–∏–Ω –¥–æ—Å—Ç–∞–ª —Å —Ä–µ—Å—É—Ä—Å–∞ [An API of Ice And Fire](https://anapioficeandfire.com/).

```{r}
got_chars <- jsonlite::read_json("https://raw.githubusercontent.com/agricolamz/2019.12.21_EU_purrr/master/data/got_chars.json")
got_chars[1]
```

–¢–∞–∫ –∫–∞–∫ `jsonlite` –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç –≤ –æ–¥–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ —Å `tidyverse`, —è –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–∏ –ø–æ–º–æ—â–∏ –∫–æ–º–∞–Ω–¥—ã `library(jsonlite)`, –∞ –æ–±—Ä–∞—â–∞—é—Å—å –∫ —Ñ—É–Ω–∫—Ü–∏—è–º –ø–∞–∫–µ—Ç–∞ –ø—Ä–∏ –ø–æ–º–æ—â–∏ –≤—ã—Ä–∞–∂–µ–Ω–∏—è `jsonlite::...()`. –ü–∞–∫–µ—Ç `jsonlite` –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å `.json` —Ñ–∞–π–ª—ã –ø—Ä–∏ –ø–æ–º–æ—â–∏ —Ñ—É–Ω–∫—Ü–∏–∏ `write_json()`:

```{r, eval=FALSE}
jsonlite::write_json(got_chars, "got_chars.json", auto_unbox = TRUE)
# –∞—Ä–≥—É–º–µ–Ω—Ç auto_unbox –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É, –∫–æ—Ç–æ—Ä—É—é –º—ã –≤–∏–¥–∏–º –≤ R
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–æ–≤ –≤ R 

–ü—Ä–æ—Å–º–æ—Ç–æ—Ä—â–∏–∫ —Å–ø–∏—Å–∫–æ–≤ –≤—Å—Ç—Ä–æ–µ–Ω –≤ RStudio. –ï–≥–æ –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å, –µ—Å–ª–∏ —Ç–∫–Ω—É—Ç—å –≤ –æ–±—ä–µ–∫—Ç –≤ R –∏–ª–∏ –Ω–∞–ø–∏—Å–∞—Ç—å –∫–æ–º–∞–Ω–¥—É `View(got_chars)`. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–æ–π –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—è `jsonedit()` –∏–∑ –ø–∞–∫–µ—Ç–∞ `listviewer`. –ö—Ä–æ–º–µ —Ç–æ–≥–æ, —á—Ç–æ-—Ç–æ –º–æ–∂–Ω–æ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –≤—ã—è—Å–Ω–∏—Ç—å, –∏—Å–ø–æ–ª—å–∑—É—è —Ñ—É–Ω–∫—Ü–∏—é `str()`.

```{r}
str(got_chars[1])
str(got_chars[1], max.level = 2)
```

## –ü–∞–∫–µ—Ç `purrr`

–í `tidyverse` –≤—Å—Ç—Ä–æ–µ–Ω –ø–∞–∫–µ—Ç `purrr`, –∫–æ—Ç–æ—Ä—ã–π —Å—Ä–µ–¥–∏ –ø—Ä–æ—á–µ–≥–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å–æ —Å–ø–∏—Å–∫–∞–º–∏. –°—É—â–µ—Å—Ç–≤—É–µ—Ç [cheat sheet –ø–æ `purrr`](https://github.com/rstudio/cheatsheets/raw/master/purrr.pdf). –ù—É –∏ –∫–æ–Ω–µ—á–Ω–æ –ø–æ–ª–Ω—ã–π [—Ç—É—Ç–æ—Ä–∏–∞–ª](https://jennybc.github.io/purrr-tutorial/index.html).

### –§—É–Ω–∫—Ü–∏—è `map()` –∏ `map...()`
–ú–æ–∂–Ω–æ –≤—ã–≤–æ–¥–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Å–ø–∏—Å–∫–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–º–µ–Ω–∏:

```{r}
got_chars %>% 
  map("name")
```

–ú–æ–∂–Ω–æ –≤—ã–≤–æ–¥–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Å–ø–∏—Å–∫–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–Ω–¥–µ–∫—Å–∞:

```{r}
got_chars %>% 
  map(3)
```

–î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–æ–ª–µ–∑–Ω–æ –∑–Ω–∞—Ç—å –æ —Ñ—É–Ω–∫—Ü–∏–∏ `unlist()`, –∫–æ—Ç–æ—Ä–∞—è "—É–±–∏–≤–∞–µ—Ç" –≤—Å–µ —Å–ª–æ–∂–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É:

```{r}
got_chars %>% 
  map("name") %>% 
  unlist()
```

–î–ª—è —ç—Ç–æ–≥–æ –µ—Å—Ç—å –∏ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–∑–≤–æ–ª—è—é—Ç –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å –≤—Å–µ –≤ –≤–µ–∫—Ç–æ—Ä –∑–∞–¥–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞:
```{r}
got_chars %>% 
  map_chr("name")
got_chars %>% 
  map_int("id")
got_chars %>% 
  map_lgl("alive")
```

–ú–æ–∂–Ω–æ –¥–∞–∂–µ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –¥–∞—Ç–∞—Ñ—Ä–µ–π–º:
```{r}
got_chars %>% 
  tibble(name = map_chr(., "name"), # —Ç–æ—á–∫–∞ –æ–±–æ–∑–Ω–∞—á–∞–µ—Ç, –≤ –∫–∞–∫–æ–π –∞—Ä–≥—É–º–µ–Ω—Ç –¥–æ–ª–∂–Ω–æ –≤—Å–µ –ø–∞–π–ø–∏—Ç—å—Å—è
         id = map_dbl(., "id"),
         alive = map_lgl(., "alive"))
```
  
–¢–∞–∫–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Å–ø–æ—Å–æ–± —Å–æ–∑–¥–∞–Ω–∏–µ –¥–∞—Ç–∞—Ñ—Ä–µ–π–º–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–µ–∫—Ç–æ—Ä–∞ –∑–Ω–∞—á–µ–Ω–∏–π –ø—Ä–∏ –ø–æ–º–æ—â–∏ —Ñ—É–Ω–∫—Ü–∏–∏ `enframe()`:

```{r}
got_chars %>% 
  map_chr("name") %>% 
  enframe()
```

#### –ó–∞–¥–∞–Ω–∏–µ 1

–°–∫–∞—á–∞–π—Ç–µ [—á–∞—Å—Ç–æ—Ç–Ω—ã–π —Å–ª–æ–≤–∞—Ä—å —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞ [–®–∞—Ä–æ–≤, –õ—è—à–µ–≤—Å–∫–∞—è 2011] (–æ–Ω —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤ `.tsv`)](https://raw.githubusercontent.com/agricolamz/DS_for_DH/master/data/freq_dict_2011.csv), —Ä–∞–∑–±–µ–π—Ç–µ —Å—Ç–æ–ª–±–µ—Ü `lemma` –Ω–∞ –±—É–∫–≤—ã –ø—Ä–∏ –ø–æ–º–æ—â–∏ —Ñ—É–Ω–∫—Ü–∏–∏ `str_split(dict$lemma, "")`, –∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–ª—É—á–µ–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ –ø–æ—Å—Ç—Ä–æ–π—Ç–µ –≥—Ä–∞—Ñ–∏–∫, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–æ, —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤—Å—Ç—Ä–µ—Ç–∏–ª–∞—Å—å –∫–∞–∫–∞—è –±—É–∫–≤–∞:

```{r, echo=FALSE, message=FALSE}
dict <- read_tsv("https://raw.githubusercontent.com/agricolamz/DS_for_DH/master/data/freq_dict_2011.csv")

str_split(dict$lemma, "") %>% 
  unlist() %>%  
  enframe() %>% 
  mutate(value = str_to_lower(value)) %>% 
  filter(str_detect(value, "\\w")) %>% 
  count(value, sort = TRUE) %>% 
  ggplot(aes(fct_reorder(value, n), n))+
  geom_col()+
  coord_flip()+
  labs(x = "", y = "", caption = "–¥–∞–Ω–Ω—ã–µ –∏–∑ [–õ—è—à–µ–≤—Å–∫–∞—è, –®–∞—Ä–æ–≤ 2011]")
```

<details> <summary> üìã —Å–ø–∏—Å–æ–∫ –ø–æ–¥—Å–∫–∞–∑–æ–∫ ‚û° </summary> 
<details> <summary> üëÅ `tidyverse` –≤–∫–ª—é—á–∏–ª–∏? ‚û° </summary>
`library(tidyverse)`.
<br>
</details>
<details> <summary> üëÅ `.tsv`? –ü–æ—á–µ–º—É —Å–ª–æ–≤–∞—Ä—å —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è –∫–∞–∫ –æ–¥–∏–Ω —Å—Ç–æ–ª–±–µ—Ü? ‚û° </summary>
`.tsv` --- —ç—Ç–æ –∫–∞–∫ `.csv`, —Ç–æ–ª—å–∫–æ –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è –Ω–µ –∑–∞–ø—è—Ç–∞—è, –∞ —Ç–∞–±—É–ª—è—Ü–∏—è (`\t`). –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –∏–ª–∏ —Ñ—É–Ω–∫—Ü–∏—é `read_tsv()` –∏–∑ –ø–∞–∫–µ—Ç–∞ `readr` (–≤—Ö–æ–¥–∏—Ç –≤ `tidyverse`).
<br>
</details>
<details> <summary> üëÅ –ü–æ—á–µ–º—É —Å–ª–æ–≤–∞—Ä—å –∫–∞–∫-—Ç–æ –∫—Ä–∏–≤–æ —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è? ‚û° </summary>
C–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –ø–æ–ª–µ—Ç–µ–ª–∞ –∫–æ–¥–∏—Ä–æ–≤–∫–∞. –Ø –≤—Å–µ –¥–µ–ª–∞—é –≤ UTF-8, —Ç–∞–∫ —á—Ç–æ –ª–∏–±–æ –ø–æ–º–µ–Ω—è–π—Ç–µ –∫–æ–¥–∏—Ä–æ–≤–∫—É –≤ —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—É—é –í—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ, –ª–∏–±–æ –∏—Å–ø–æ–ª–±–∑—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é `read_tsv()` –∏–∑ –ø–∞–∫–µ—Ç–∞ `readr` (–≤—Ö–æ–¥–∏—Ç –≤ `tidyverse`) --- –æ–Ω–∞ —Å–∞–º–∞ –±–æ—Ä–µ—Ç—Å—è —Å –∫–æ–¥–∏—Ä–æ–≤–∫–∞–º–∏.
<br>
</details>

<details> <summary> üëÅ –ü–æ–ª—É—á–∏–ª—Å—è —Å–ø–∏—Å–æ–∫. –ê-–∞-–∞-–∞! –ö–∞–∫ –µ–≥–æ —É–±—Ä–∞—Ç—å? ‚û° </summary>
–≠—Ç–æ –ø—Ä–æ—Å—Ç–æ–π —Å–ª—É—á–∞–π, —Ç–∞–∫ —á—Ç–æ –≤ –∫–∞–∫–æ–º-—Ç–æ —Å–º—ã—Å–ª–µ —Å–ø–∏—Å–æ—á–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–µ –æ—á–µ–Ω—å –Ω—É–∂–Ω–∞. –¢–∞–∫ —á—Ç–æ –º–æ–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ `unlist()`.
<br>
</details>

<details> <summary> üëÅ –Ø –ø–æ–ª—É—á–∏–ª –≤–µ–∫—Ç–æ—Ä. –ê —á—Ç–æ –¥–∞–ª—å—à–µ? ‚û° </summary>
–í –ø—Ä–∏–Ω—Ü–∏–ø–µ, –≥—Ä–∞—Ñ–∏–∫ `ggplot2` —Ç—Ä–µ–±—É–µ—Ç –Ω–∞ –≤—Ö–æ–¥ –¥–∞—Ç–∞—Ñ—Ä–µ–π–º, —Ç–∞–∫ —á—Ç–æ –µ–≥–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø—Ä–∏ –ø–æ–º–æ—â–∏ —á–µ–≥–æ —É–≥–æ–¥–Ω–æ. –Ø –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª `enframe()`.
<br>
</details>

<details> <summary> üëÅ –ö–∞–∫–∏–µ-—Ç–æ –±—É–∫–≤—ã –±–æ–ª—å—à–∏–µ, –∫–∞–∫–∏–µ-—Ç–æ –º–∞–ª–µ–Ω—å–∫–∏–µ... –ß—Ç–æ –¥–µ–ª–∞—Ç—å? ‚û° </summary>
–°—É—â–µ—Å—Ç–≤—É–µ—Ç –º–Ω–æ–≥–æ —Å–ø–æ—Å–æ–±–æ–≤ –ø—Ä–∏–≤–µ—Å—Ç–∏ –≤—Å–µ –∫ —Å—Ç—Ä–æ—á–Ω—ã–º –±—É–∫–≤–∞–º: `tolower("–í–ê–®–ê –°–¢–†–û–ö–ê")` –∏–∑ –±–∞–∑–æ–≥–æ R, –∏–ª–∏ `str_to_lower()` –∏–∑ –ø–∞–∫–µ—Ç–∞ `stringr` (–≤—Ö–æ–¥–∏—Ç –≤ `tidyverse`).
<br>
</details>

<details> <summary> üëÅ –ê –∫–∞–∫ —É–±—Ä–∞—Ç—å –¥–µ—Ñ–∏—Å –∏ –∞–ø–æ—Å—Ç—Ä–æ—Ñ? ‚û° </summary>
–ù—É –≤–æ-–ø–µ—Ä–≤—ã—Ö, —á—Ç–æ-—Ç–æ –Ω—É–∂–Ω–æ —É–±—Ä–∞—Ç—å, –∞ —á—Ç–æ-—Ç–æ –æ—Å—Ç–∞–≤–∏—Ç—å --- –∑–Ω–∞—á–∏—Ç –Ω—É–∂–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `filter()` –∏–∑ –ø–∞–∫–µ—Ç–∞ `dplyr`. –ê –¥–∞–ª—å—à–µ —É–∂–µ –≤–æ–ø—Ä–æ—Å —Ç–µ—Ö–Ω–∏–∫–∏: –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Å—Ç—É—Ä–∫—Ü–∏—é `value != "-"`. –ê –º–æ–∂–Ω–æ —É–±–∏—Ç—å –¥–≤—É—Ö –∑–∞–π—Ü–µ–≤ –æ–¥–Ω–∏–º –≤—ã—Å—Ç—Ä–µ–ª–æ–º –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–≥—É–ª—è—Ä–∫—É: `filter(str_detect(value, "\\w"))`.
<br>
</details>

<details> <summary> üëÅ –ê –∫–∞–∫ –ø–æ—Å—á–∏—Ç–∞—Ç—å –∫–æ–≥–æ —Å–∫–æ–ª—å–∫–æ? ‚û° </summary>
–î–ª—è —ç—Ç–æ–≥–æ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `count()`. –ú–æ–∂–Ω–æ –±—ã–ª–æ –≤–æ–æ–±—â–µ –Ω–µ —Å—á–∏—Ç–∞—Ç—å –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `geom_bar()`, –Ω–æ —Ç–æ–≥–¥–∞ –Ω–µ –ø–æ–ª—É—á–∏—Ç—å—Å—è –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é.
<br>
</details>

<details> <summary> üëÅ –ê –∫–∞–∫–æ–π `geom_` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å? ‚û° </summary>
–Ø –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª `geom_col()`. –ú–æ–∂–Ω–æ –µ—â–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `geom_bar()` –Ω–∞ –Ω–µ–∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –Ω–æ —Ç–æ–≥–¥–∞ –Ω–µ —É–¥–∞—Å—Ç—Å—è –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å.
<br>
</details>

<details> <summary> üëÅ –ê –∫–∞–∫ –ø–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç—å –æ—Å–∏? ‚û° </summary>
–î–æ–±–∞–≤—å—Ç–µ `coord_flip()` –∫ –æ–±—ä–µ–∫—Ç—É `ggplot`.
<br>
</details>

<details> <summary> üëÅ –ê –∫–∞–∫ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é? ‚û° </summary>
–î–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–æ –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –≤ —Ñ–∞–∫—Ç–æ—Ä —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –ø–æ—Ä—è–¥–∫–æ–º. –Ø —ç—Ç–æ –æ–±—ã—á–Ω–æ –¥–µ–ª–∞—é –ø—Ä–∏ –ø–æ–º–æ—â–∏ —Ñ—É–Ω–∫—Ü–∏–∏ `fct_reorder()` –∏–∑ –ø–∞–∫–µ—Ç–∞ `forcats` (–≤—Ö–æ–¥–∏—Ç –≤ `tidyverse`) —É–∂–µ –≤ `ggplot()`: `data %>% ggplot(aes(x = fct_reorder(value, n), y = n)) + ...`.
<br>
</details>
</details>

#### –ó–∞–¥–∞–Ω–∏–µ 2 (–¥–æ–º–æ–π)
–í –¥–∞—Ç–∞—Å–µ—Ç–µ, —Å–æ–±—Ä–∞–Ω–Ω—ã–π [Adithya Ganesh](https://www.kaggle.com/adithyarganesh/english-premier-league-player-data-20182019#fpl_data_2018_2019.json), —Ö—Ä–∞–Ω–∏—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏–≥—Ä–∞–∫–∞—Ö –ê–Ω–≥–ª–∏–π—Å–∫–æ–π –ü—Ä–µ–º—å–µ—Ä-–ª–∏–≥–∏. –ù–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ —ç—Ç–∏—Ö –¥–∞–Ω–Ω—ã—Ö (–ª–µ–∂–∞—Ç –≤ –ø–∞–ø–∫–µ `data`) –ø–æ—Å—Ç—Ä–æ–π—Ç–µ –≥—Ä–∞—Ñ–∏–∫ 30 –∏–≥—Ä–æ–∫–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–±–∏–ª–∏ –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –≥–æ–ª–æ–≤ –∏ —Ä–∞—Å–∫—Ä–∞—Å—å—Ç–µ –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ –∏—Ö —Ñ—É—Ç–±–æ–ª—å–Ω–æ–≥–æ –∫–ª—É–±–∞.


```{r, echo=FALSE, message=FALSE}
fpl <- jsonlite::read_json("https://raw.githubusercontent.com/r-classes/2019_2020_ds4dh_hw3_purr_gutenbergr_tidytext_udpipe/master/data/fpl_data_2018_2019.json")
fpl %>% 
  tibble(name = names(fpl),
         club = map_chr(., "Club"),
         goals = map_chr(., "Goals")) %>% 
  mutate(goals = as.integer(goals)) %>% 
  arrange(-goals) %>% 
  slice(1:30) %>% 
  ggplot(aes(fct_reorder(name, goals), goals, fill = club))+
  geom_col()+
  coord_flip()+
  labs(x = "", y = "", title = "Number of Goals", caption = "data from www.premierleague.com")
```

### –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–ø–∏—Å–∫–æ–≤

–ï—Å–ª–∏ –≤ —Å–ø–∏—Å–∫–µ –µ—Å—Ç—å –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è, –∏—Ö –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ —Ñ–∏–ª—å—Ç—Ä—ã. –ù–∞–ø—Ä–∏–º–µ—Ä, –≤–æ—Ç —Ç–∞–∫ –º—ã –æ—Å—Ç–∞–≤–∏–º —Ç–æ–ª—å–∫–æ –∂–∏–≤—ã—Ö –≥–µ—Ä–æ–µ–≤:
```{r}
got_chars %>% 
  keep("alive") %>% 
  map_chr("name")
```

![](images/6.02_keep.png)

–ê —Ç–∞–∫ -- —Ç–æ–ª—å–∫–æ –º–µ—Ä—Ç–≤—ã—Ö:
```{r}
got_chars %>% 
  discard("alive") %>% 
  map_chr("name")
```

![](images/6.03_discard.png)

–¢–∞–∫–∂–µ –µ—Å—Ç—å –æ—Å–æ–±—ã–π —Ñ–∏–ª—å—Ç—Ä `head_while()` –∏ `tail_while()`, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–¥–µ–ª—è–µ—Ç –µ–¥–∏–Ω–∏—Ü—ã (—Å –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞) –¥–æ –ø–µ—Ä–≤–æ–≥–æ `FALSE`.

```{r}
got_chars %>% 
  head_while("alive") %>% 
  map_chr("name")

got_chars %>% 
  tail_while("alive") %>% 
  map_chr("name")
```

![](images/6.04_head_while.png)

–ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –Ω–µ –ø–æ–Ω—è—Ç–Ω–æ, –≤–∑–≥–ª—è–Ω–∏—Ç–µ –Ω–∞ –Ω–∞—à—É —Ç–∞–±–ª–∏—Ü—É:
```{r}
got_chars %>% 
  tibble(name = map_chr(., "name"), # —Ç–æ—á–∫–∞ –æ–±–æ–∑–Ω–∞—á–∞–µ—Ç, –≤ –∫–∞–∫–æ–π –∞—Ä–≥—É–º–µ–Ω—Ç –¥–æ–ª–∂–Ω–æ –≤—Å–µ –ø–∞–π–ø–∏—Ç—å—Å—è
         alive = map_lgl(., "alive"))
```

### –û–ø–µ—Ä–∞—Ü–∏–∏ —Å–æ —Å–ø–∏—Å–∫–∞–º–∏

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º –ø—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä:

```{r}
my_l <- list(a = 1:3, b = c("a", "b"), c = list("z", c(8, 9)))
my_l
```

–ö–∞–∫ —É–∂–µ –≥–æ–≤–æ—Ä–∏–ª–æ—Å—å –≤—ã—à–µ, —Ñ—É–Ω–∫—Ü–∏—è `unlist()` –ª–∏–Ω–µ–∞—Ä–∏–∑—É–µ—Ç —Å–ø–∏—Å–∫–∏, –ø—Ä–µ–≤—Ä–∞—â–∞—è –∏—Ö –≤ –≤–µ–∫—Ç–æ—Ä—ã:

```{r}
my_l %>% 
  unlist()
```

–ü–æ–ª—É—á–∏–ª—Å—è –ø–æ–∏–º–µ–Ω–Ω–æ–≤–∞–Ω–Ω—ã–π –≤–µ–∫—Ç–æ—Ä, –µ—Å–ª–∏ —ç—Ç–æ–≥–æ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ, –º–æ–∂–Ω–æ —É–Ω–∏—á—Ç–æ–∂–∏—Ç—å –∏ –∏–º–µ–Ω–∞ –ø—Ä–∏ –ø–æ–º–æ—â–∏ —Ñ—É–Ω–∫—Ü–∏–∏ `unname()`:

```{r}
my_l %>% 
  unlist() %>% 
  unname()
```

–§—É–Ω–∫—Ü–∏—è `flatten` –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–Ω–∏—á—Ç–æ–∂–∏—Ç—å **–ª–∏—à—å –æ–¥–∏–Ω, –≤–µ—Ä—Ö–Ω–∏–π,**, —É—Ä–æ–≤–µ–Ω—å –∏–µ—Ä–∞—Ä—Ö–∏–∏:
```{r}
my_l %>% 
  flatten()
```

![](images/6.05_flatten.png)

–ö–∞–∫ –≤–∏–¥–Ω–æ –∏–∑ —ç—Ç–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞, –ø–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç —Å–ø–∏—Å–∫–∞ `my_l` –ø—Ä–µ–≤—Ä–∞—Ç–∏–ª—Å—è –≤ —Ç—Ä–∏ –ø–µ—Ä–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–∞ —Å–ø–∏—Å–∫–∞, –∞ –≤–æ—Ç –ø–æ–¥—Å–ø–∏—Å–æ–∫ `c = list("z", c(8, 9))` –ø—Ä–µ–≤—Ä–∞—Ç–∏–ª—Å—è –≤ —ç–ª–µ–º–µ–Ω—Ç `z` –∏ –≤–µ–∫—Ç–æ—Ä `c(8, 9)`.

–°—É—â–µ—Å—Ç–≤—É—é—Ç —Ç–∞–∫–∂–µ —Ñ—É–Ω–∫—Ü–∏–∏ `append()` –∏ `prepend()`, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–∑–≤–æ–ª—è—é—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–π –ø–æ—Å–ø–∏—Å–æ–∫ –ø–æ—Å–ª–µ (–∏–ª–∏ –¥–æ) —Å—Ç–∞—Ä–æ–≥–æ:

```{r}
list(c(1, 2), c("a", "b", "c")) %>% 
  append(list(new = c(TRUE, FALSE)))
list(c(1, 2), c("a", "b", "c")) %>% 
  prepend(list(new = c(TRUE, FALSE)))
```

–°—É—â–µ—Å—Ç–≤—É–µ—Ç —Ç–∞–∫–∂–µ —Ñ—É–Ω–∫—Ü–∏–∏ `cross()` –∏ `cross2()`, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–∑–≤–æ–ª—è—é—Ç –ø–æ–ª—É—á–∏—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –æ–±—ä–µ–∫—Ç–æ–≤ –∏–∑ –¥–≤—É—Ö —Å–ø–∏—Å–∫–æ–≤:
```{r}
list(c("a", "b"), 1:3) %>% 
  cross() %>% 
  str()

list("a", "b") %>% 
  cross2(1:3) %>% 
  str()
```

## –†–µ–±—Ä–µ–Ω–¥–∏–Ω–≥ —Ñ—É–Ω–∫—Ü–∏–∏ `map()`

–ù–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ `map()` --- —è–≤–ª—è—é—Ç—Å—è —Ü–∏–∫–ª–∞–º–∏ —Å–æ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π:

```
map(you_object, your_function)
```

–≠—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –º—ã –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `map()`

* –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏–π –≤ –æ–¥–Ω–æ–º –∏–∑ –≤–µ–∫—Ç–æ—Ä–æ–≤ –¥–∞—Ç–∞—Ñ—Ä–µ–π–º–∞

```{r}
diamonds %>% 
  mutate(price_rubl = map_dbl(price, function(x){x*62.24}))

# —Å—Ä–∞–≤–Ω–∏—Ç–µ!
# diamonds %>% 
#   mutate(price_rubl = price*62.24)
```

* –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫—É—á–µ–π —Ñ–∞–π–ª–æ–≤

–í –¥–∞—Ç–∞—Å–µ—Ç–∞—Ö —Å–æ–¥–µ—Ä–∂–∞—Ç—å—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–±—ä–µ–∫—Ç–∞—Ö, –≤—ã–¥–∞–Ω–Ω—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π –°–∏—ç—Ç–ª–∞ 100 –∏ –±–æ–ª–µ–µ —Ä–∞–∑ (–∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã [–∑–¥–µ—Å—å](https://data.seattle.gov/dataset/Checkouts-by-Title-Physical-Items-/3h5r-qv5w)). –î–∞—Ç–∞—Å–µ—Ç —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –∫—É—á–∏ `.csv` —Ñ–∞–π–ª–æ–≤ —Å 5 –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏:

* `id` -- –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–æ–Ω–Ω—ã–π –Ω–æ–º–µ—Ä –æ–±—ä–µ–∫—Ç–∞
* `type` -- —Ç–∏–ø –æ–±—ä–µ–∫—Ç–∞ (`bk` -- –∫–Ω–∏–≥–∞, `bknh` -- –¥—Ä—É–≥–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è —Å –∫–Ω–∏–≥–∞–º–∏, `cas` -- –∫–∞—Å—Å–µ—Ç—ã, `cd` -- CD, `dvd` -- DVD, `kit` -- –∫–æ–º–ø–ª–µ–∫—Ç (—è —Å–∞–º –ø–æ–∫–∞ –Ω–µ —Ä–∞–∑–æ–±—Ä–∞–ª—Å—è —á—Ç–æ —Ç–∞–º...), `vhs` -- –≤–∏–¥–µ–æ–∫–∞—Å—Å–µ—Ç—ã VHS)
* `name` -- –Ω–∞–∑–≤–∞–Ω–∏–µ
* `n` -- —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤–∑—è–ª–∏ –≤ —Ç–æ–º –∏–ª–∏ –∏–Ω–æ–º—É –≥–æ–¥—É
* `year` -- –≥–æ–¥

–î–∞–Ω–Ω—ã–µ –ª–µ–∂–∞—Ç –≤–æ—Ç –∑–¥–µ—Å—å:

* https://raw.githubusercontent.com/agricolamz/2019.12.21_EU_purrr/master/data/seattle_public_library_2005.csv
* https://raw.githubusercontent.com/agricolamz/2019.12.21_EU_purrr/master/data/seattle_public_library_2006.csv
* ...
* https://raw.githubusercontent.com/agricolamz/2019.12.21_EU_purrr/master/data/seattle_public_library_2019.csv

–î–∞–≤–∞–π—Ç–µ —Å—á–∏—Ç–∞–µ–º –∏—Ö –≤—Å–µ:

```{r, message=FALSE}
links <- str_c("https://raw.githubusercontent.com/agricolamz/2019.12.21_EU_purrr/master/data/seattle_public_library_", 2005:2019, ".csv")

df <- map(links, read_csv)
str(df, max.level = 1)
```


–ú–æ–∂–Ω–æ –¥–∞–∂–µ —Å–æ–µ–¥–∏–Ω–∏—Ç—å –∏—Ö –≤ –æ–¥–∏–Ω –¥–∞—Ç–∞—Ñ—Ä–µ–π–º:

```{r, message=FALSE}
df_2 <- map_dfr(links, read_csv)
df_2
df_2 %>%
  group_by(type, name) %>%
  summarise(sum_n = sum(n))  %>%
  ungroup() %>%
  arrange(-sum_n) %>%
  slice(1:100) %>%
  ggplot(aes(fct_reorder(str_trunc(name, 40), sum_n), sum_n, fill = type))+
  geom_col()+
  coord_flip()+
  labs(x = "", y = "",
       title = "Most popular physical item checkouts from Seattle Public Library (2005-2019)",
       caption = "data from https://data.seattle.gov/dataset/Checkouts-by-Title-Physical-Items-/3h5r-qv5w")
```

